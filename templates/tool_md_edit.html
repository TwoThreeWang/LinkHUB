{{ define "meta" }}
<title>{{ .title }} - {{ .siteName }}</title>
<meta name="keywords" content="{{ .siteName }},{{.Keywords}}">
<meta name="description" content="æç®€çš„åœ¨çº¿ MarkDown ç¼–è¾‘å™¨ï¼Œ{{ .siteName }}">
<style>
    .editor-div{
        border: 1px solid var(--color-border);
        border-radius: var(--border-radius);
    }
    .toolbar {
        border-bottom: 1px solid #e0e0e0;
        position: sticky;
        top: 48px;
        background: white;
        z-index: 100;
        transition: all 0.3s ease;
    }
    .toolbar button {
        padding: 6px 12px;
        border: 0;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    .toolbar button:hover {
        background: #f0f0f0;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .editor-container {
        display: flex;
    }

    @media (max-width: 768px) {
        .editor-container {
            flex-direction: column;
        }
        #post-content {
            border-left: 0;
            border-top: 1px solid #e0e0e0;
            min-height: 200px;
        }
        .toolbar{
            top: 93px;
        }
    }
    .editor-section {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    #editor {
        flex: 1;
        resize: none;
        min-height: 400px;
        border: 0;
        border-radius: 0;
    }
    #post-content {
        flex: 1;
        min-height: 400px;
        background: #ffffff;
        border-left: 1px solid #e0e0e0;
        overflow-y: auto;
        padding: 0.5rem 0.75rem;
    }
</style>
{{ end }}

{{ define "content" }}
    <h2>âœ¨ï¸ MarkDown ç¼–è¾‘å™¨</h2>
    <p>Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå…¶è½»é‡åŒ–ã€æ˜“è¯»æ˜“å†™ç‰¹æ€§ï¼Œå¹¶ä¸”å¯¹äºå›¾ç‰‡ï¼Œå›¾è¡¨ã€æ•°å­¦å¼éƒ½æœ‰æ”¯æŒï¼Œè®¸å¤šç½‘ç«™éƒ½å¹¿æ³›ä½¿ç”¨ Markdown æ¥æ’°å†™å¸®åŠ©æ–‡æ¡£æˆ–æ˜¯ç”¨äºè®ºå›ä¸Šå‘è¡¨æ¶ˆæ¯ã€‚</p>
    <br>
    <div class="editor-div">
        <div class="toolbar">
            <button onclick="insertMarkdown('# ')" title="æ ‡é¢˜1">H1</button>
            <button onclick="insertMarkdown('## ')" title="æ ‡é¢˜2">H2</button>
            <button onclick="insertMarkdown('### ')" title="æ ‡é¢˜3">H3</button>
            <button onclick="insertMarkdown('**', '**')" title="åŠ ç²—"><b>B</b></button>
            <button onclick="insertMarkdown('*', '*')" title="æ–œä½“"><i>I</i></button>
            <button onclick="insertMarkdown('- ')" title="æ— åºåˆ—è¡¨">â€¢</button>
            <button onclick="insertMarkdown('1. ')" title="æœ‰åºåˆ—è¡¨">1.</button>
            <button onclick="insertMarkdown('[', '](url)')" title="é“¾æ¥">Link</button>
            <button onclick="insertMarkdown('![alt](', ')')" title="å›¾ç‰‡">Pic</button>
            <button onclick="insertMarkdown('`', '`')" title="ä»£ç ">Code</button>
            <button onclick="insertMarkdown('```\n', '\n```')" title="ä»£ç å—">Codes</button>
            <button onclick="showEmojiPicker()" title="è¡¨æƒ…">ğŸ˜Š</button>
            <a href="/tools/image/me" target="_blank" title="å›¾åºŠ"><button >å›¾åºŠ</button></a>
            <div id="emoji-picker" class="toolbar" style="display: none;"></div>
        </div>

        <div class="editor-container">
            <div class="editor-section">
                <textarea id="editor" placeholder="Markdown ç¼–è¾‘"></textarea>
            </div>
            <div class="editor-section">
                <div id="post-content"></div>
            </div>
        </div>
    </div>
    <script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/marked/4.0.2/marked.min.js" type="application/javascript"></script>

    <script>
        // ç›‘å¬æ»šåŠ¨äº‹ä»¶å®ç°toolbarå¸é¡¶
        window.addEventListener('scroll', function() {
            const toolbar = document.querySelector('.toolbar');
            if (window.scrollY > 100) {
                toolbar.style.boxShadow = '0 2px 10px rgba(0,0,0,0.1)';
            } else {
                toolbar.style.boxShadow = 'none';
            }
        });
        const editor = document.getElementById('editor');
        const previewDiv = document.getElementById('post-content');

        // å®æ—¶é¢„è§ˆåŠŸèƒ½
        function updatePreview() {
            const markdownContent = editor.value;
            const htmlContent = marked.parse(markdownContent);
            previewDiv.innerHTML = htmlContent;
        }

        // ç›‘å¬è¾“å…¥äº‹ä»¶å®ç°å®æ—¶é¢„è§ˆ
        editor.addEventListener('input', updatePreview);
        editor.addEventListener('change', updatePreview);

        // Markdownå¿«æ·é”®æ’å…¥åŠŸèƒ½
        function insertMarkdown(prefix, suffix = '') {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;
            const selectedText = text.substring(start, end);

            // æ’å…¥Markdownè¯­æ³•
            const insertion = prefix + selectedText + suffix;
            editor.value = text.substring(0, start) + insertion + text.substring(end);

            // é‡æ–°è®¾ç½®å…‰æ ‡ä½ç½®
            const newCursorPos = start + insertion.length;
            editor.setSelectionRange(newCursorPos, newCursorPos);
            editor.focus();

            // æ›´æ–°é¢„è§ˆ
        updatePreview();
    }

    // è¡¨æƒ…é€‰æ‹©åŠŸèƒ½
    function showEmojiPicker() {
        const picker = document.getElementById('emoji-picker');
        if (picker.style.display === 'none') {
            // åªæœ‰å†…å®¹ä¸ºç©ºæ—¶æ‰æ¸²æŸ“è¡¨æƒ…æŒ‰é’®
            if (!picker.innerHTML) {
                const emojis = ['ğŸ˜€', 'ğŸ˜‚', 'ğŸ˜', 'ğŸ‘', 'â¤ï¸', 'ğŸ”¥', 'ğŸ‰', 'ğŸ¤”', 'ğŸ™', 'âœ¨', 'ğŸ˜Š', 'ğŸ˜', 'ğŸ˜¢', 'ğŸ˜¡', 'ğŸ˜´', 'ğŸ¤¯', 'ğŸ¥³', 'ğŸ¤©', 'ğŸ¥°', 'ğŸ¤ª', 'ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ', 'ğŸ•', 'ğŸ”', 'ğŸŸ', 'ğŸ¦', 'ğŸ©', 'â˜•', 'ğŸŒ', 'ğŸŒ§ï¸', 'â›„', 'ğŸ„', 'ğŸ', 'ğŸš—', 'âœˆï¸', 'ğŸš²', 'âš½', 'ğŸ€', 'ğŸ¾', 'ğŸ§', 'ğŸ“±', 'ğŸ’»', 'âŒš', 'ğŸ“š', 'âœï¸', 'ğŸ¨', 'ğŸ®', 'ğŸ¤', 'ğŸ¸', 'ğŸ»', 'ğŸº', 'ğŸ”', 'ğŸ•', 'ğŸ£', 'ğŸœ', 'ğŸ©', 'ğŸ«', 'ğŸ­', 'ğŸº', 'ğŸ·', 'ğŸµ', 'â˜•', 'ğŸŒ¹', 'ğŸŒ¸', 'ğŸŒ»', 'ğŸŒ´', 'ğŸŒ', 'ğŸŒ•', 'â­', 'ğŸŒˆ', 'âš¡', 'â„ï¸', 'â°', 'ğŸ”‘', 'ğŸ’¡', 'ğŸ’°', 'ğŸ’', 'ğŸ’Œ', 'ğŸ’˜', 'ğŸ’', 'ğŸ’–', 'ğŸ’¯']; // æ‰©å±•æ›´å¤šåˆ†ç±»çš„è¡¨æƒ…ç¬¦å·
                picker.innerHTML = emojis.map(emoji =>
                    `<button onclick="insertMarkdown('${emoji}')">${emoji}</button>`
                ).join('');
            }
            picker.style.display = 'block';
        } else {
            picker.style.display = 'none';
        }
    }

    // å›¾ç‰‡ç²˜è´´åŠŸèƒ½
    document.addEventListener('paste', async (e) => {
        const items = e.clipboardData.items;
        for (let item of items) {
            if (item.type.startsWith('image/')) {
                // æ˜¾ç¤ºä¸Šä¼ æç¤º
                insertMarkdown('\n![å›¾ç‰‡ä¸Šä¼ ä¸­...]()\n');

                const file = item.getAsFile();
                const formData = new FormData();
                formData.append('image', file);
                formData.append('storageType', "imgur");

                try {
                    const response = await fetch('/api/img_upload', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();

                    if (result.code === 200) {
                        const imgUrl = result.data.img_url.replace('https://i.imgur.com/','https://cdn.c2v2.com/imgur/');
                        // æ›¿æ¢ä¸Šä¼ æç¤ºä¸ºå®é™…å›¾ç‰‡
                        const newContent = editor.value.replace('![å›¾ç‰‡ä¸Šä¼ ä¸­...]()', `![${file.name}](${imgUrl})`);
                        editor.value = newContent;
                        updatePreview();
                    } else {
                        // æ›¿æ¢ä¸Šä¼ æç¤ºä¸ºé”™è¯¯ä¿¡æ¯
                        const newContent = editor.value.replace('![å›¾ç‰‡ä¸Šä¼ ä¸­...]()', `![å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${result.message}]()`);
                        editor.value = newContent;
                        updatePreview();
                    }
                } catch (error) {
                    console.error('ä¸Šä¼ å‡ºé”™:', error);
                    const newContent = editor.value.replace('![å›¾ç‰‡ä¸Šä¼ ä¸­...]()', `![å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${result.message}]()`);
                    editor.value = newContent;
                    updatePreview();
                }
                break;
            }
        }
    });
    </script>
{{ end }}