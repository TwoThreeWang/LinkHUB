{{ define "meta" }}
<title>{{ .title }} - {{ .siteName }}</title>
<meta name="keywords" content="{{ .siteName }},{{.Keywords}}">
<meta name="description" content="AI文章总结工具，使用人工智能技术，快速提取文章核心内容，生成结构化摘要，提高阅读效率，{{ .siteName }}">
<!-- Markdown 解析库 -->
<script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/marked/4.0.2/marked.min.js"></script>
<style>
.input-section {
    background: var(--color-background);
    padding: var(--space-lg);
    border-radius: var(--border-radius);
    border: 1px solid var(--color-border);
    margin-bottom: var(--space-lg);
}

.input-tabs {
    display: flex;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
}

.input-tab {
    padding: var(--space-sm) var(--space-lg);
    cursor: pointer;
    border-bottom: 2px solid transparent;
}

.input-tab.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
}

.input-content {
    display: none;
}

.input-content.active {
    display: block;
}

.result-section {
    background: var(--color-background);
    padding: var(--space-lg);
    border-radius: var(--border-radius);
    border: 1px solid var(--color-border);
}

.result-tabs {
    display: flex;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
    border-bottom: 1px solid var(--color-border);
}

.result-tab {
    padding: var(--space-sm) var(--space-lg);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
}

.result-tab.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
}

.result-content {
    display: none;
}

.result-content.active {
    display: block;
}
</style>
{{ end }}

{{ define "content" }}
<div class="content">
    <h2>✨️ AI文章分析工具</h2>
    <p>输入任意文章链接，让 AI 为您生成简洁明了的摘要，节省阅读时间，提高学习效率</p>
    <br>
    <!-- 输入区域 -->
    <div class="input-section">
        <div class="input-tabs">
            <div class="input-tab active" data-tab="url">文章URL</div>
            <div class="input-tab" data-tab="content">文章内容</div>
        </div>

        <div class="input-content active" id="url-input">
            <div class="form-group">
                <input type="text" class="form-control" placeholder="请输入文章URL" id="article-url">
            </div>
        </div>

        <div class="input-content" id="content-input">
            <div class="form-group">
                <textarea class="form-control" rows="10" placeholder="请输入文章内容" id="article-content"></textarea>
            </div>
        </div>

        <button class="btn btn-primary" id="analyze-btn">开始总结</button>
        <small style="color:#999"> 使用 Google Gemini 生成</small>
    </div>

    <div id="msg" style="display: none;"></div>

    <!-- 结果展示区域 -->
    <div class="result-section" id="result-section" style="display: none;">
        <div class="result-tabs">
            <div class="result-tab active" data-tab="summary">AI 解析结果</div>
            <div class="result-tab" data-tab="markdown">MD 原文</div>
        </div>

        <div class="result-content active" id="summary-content">
            <div id="ai-result"><div class="empty-state"><p><i class="fa fa-circle-o-notch"></i> 暂无内容</p></div></div>
        </div>

        <div class="result-content" id="markdown-content">
            <pre id="md-content"><div class="empty-state"><p><i class="fa fa-circle-o-notch"></i> 暂无内容</p></div></pre>
        </div>
        <br>
        <button class="btn btn-outline-primary" id="copy-md-btn">复制 MD 原文</button>
    </div>
</div>

<script>
// 切换输入方式
document.querySelectorAll('.input-tab').forEach(tab => {
    tab.addEventListener('click', () => {
        // 移除所有active类
        document.querySelectorAll('.input-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.input-content').forEach(c => c.classList.remove('active'));

        // 添加active类到当前选中的tab
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}-input`).classList.add('active');
    });
});

// 切换结果展示
document.querySelectorAll('.result-tab').forEach(tab => {
    tab.addEventListener('click', () => {
        // 移除所有active类
        document.querySelectorAll('.result-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.result-content').forEach(c => c.classList.remove('active'));

        // 添加active类到当前选中的tab
        tab.classList.add('active');
        document.getElementById(`${tab.dataset.tab}-content`).classList.add('active');
    });
});

// 分析按钮点击事件
document.getElementById('analyze-btn').addEventListener('click', async () => {
    const activeTab = document.querySelector('.input-tab.active').dataset.tab;
    let content = '';

    if (activeTab === 'url') {
        content = document.getElementById('article-url').value;
    } else {
        content = document.getElementById('article-content').value;
    }

    if (!content) {
        showToast('请输入内容', 'error');
        return;
    }
    showToast('AI正在分析文章并生成摘要，这可能需要几秒钟...', 'success');
    // TODO: 调用后端API进行分析
    try {
        const response = await fetch('/api/article-insight-ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                type: activeTab,
                content: content
            })
        });

        const result = await response.json();
        if (result.code == 200) {
            document.getElementById('result-section').style.display = 'block';
            showToast('已完成总结', 'success');
            document.getElementById('ai-result').innerHTML = marked.parse(result.data.summary);
            document.getElementById('md-content').innerHTML = result.data.summary;
            // 滚动到ai-result
            document.getElementById('ai-result').scrollIntoView();
        } else {
            showToast(result.message || '分析失败', 'error');
        }
    } catch (error) {
        showToast('请求失败，请稍后重试', 'error');
    }
});
// 初始化复制按钮事件
document.getElementById('copy-md-btn').addEventListener('click', () => {
    const mdContent = document.getElementById('md-content').innerText;
    navigator.clipboard.writeText(mdContent).then(() => {
        showToast('复制成功', 'success');
    }).catch(() => {
        showToast('复制失败，请重试', 'error');
    });
    document.getElementById('msg').scrollIntoView();
});
</script>
{{ end }}